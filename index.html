<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Real-time browser-based engine sound simulator using Web Audio API">
  <meta name="theme-color" content="#00ff88">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="EngineSim">
  <title>Realtime Engine Simulator</title>
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <div class="container" role="main">
    <h1>Engine Simulator</h1>

    <!-- Real Vehicle Mode Toggle (prominent, top of page) -->
    <div class="real-vehicle-toggle-bar" id="real-vehicle-toggle-bar">
      <span class="real-vehicle-toggle-label">üöó Real Vehicle Mode</span>
      <label class="toggle-switch" aria-label="Enable real vehicle mode using GPS and accelerometer">
        <input type="checkbox" id="real-vehicle-mode-top">
        <span class="toggle-slider"></span>
      </label>
      <span id="sensor-status-top" class="sensor-status">Off</span>
    </div>

    <div class="dashboard" role="region" aria-label="Engine status display">
      <!-- Real Vehicle Speed Display (shown only in real vehicle mode) -->
      <div id="real-vehicle-speed-display" class="real-vehicle-speed-display" style="display:none;" aria-label="Real vehicle GPS speed">
        <div class="real-vehicle-speed-value"><span id="gps-speed-value">0</span></div>
        <div class="real-vehicle-speed-label">üìç Real Vehicle Speed (km/h)</div>
      </div>

      <!-- Circular RPM Gauge -->
      <div class="rpm-gauge-circular">
        <svg viewBox="0 0 200 200" class="gauge-svg">
          <defs>
            <linearGradient id="gauge-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" />
              <stop offset="70%" style="stop-color:#ffcc00;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#ff0055;stop-opacity:1" />
            </linearGradient>
          </defs>
          <!-- Background arc -->
          <path d="M 30 170 A 80 80 0 1 1 170 170" fill="none" stroke="#333" stroke-width="20" stroke-linecap="round"/>
          <!-- Progress arc -->
          <path id="rpm-arc" d="M 30 170 A 80 80 0 1 1 170 170" fill="none" stroke="url(#gauge-gradient)" stroke-width="20" stroke-linecap="round"/>
          <!-- Shift lights -->
          <circle cx="50" cy="50" r="4" class="shift-light" id="shift-light-1"/>
          <circle cx="70" cy="35" r="4" class="shift-light" id="shift-light-2"/>
          <circle cx="100" cy="30" r="4" class="shift-light" id="shift-light-3"/>
          <circle cx="130" cy="35" r="4" class="shift-light" id="shift-light-4"/>
          <circle cx="150" cy="50" r="4" class="shift-light" id="shift-light-5"/>
          <!-- Center display -->
          <text x="100" y="110" text-anchor="middle" class="rpm-text" id="rpm-value">0</text>
          <text x="100" y="130" text-anchor="middle" class="rpm-unit">RPM</text>
        </svg>
      </div>

      <!-- Spectrum Analyzer -->
      <div class="spectrum-container" aria-label="Real-time frequency spectrum analyzer">
        <canvas id="spectrum-canvas" class="spectrum-canvas" aria-hidden="true"></canvas>
      </div>

      <!-- Main Controls (moved above speed display) -->
      <div class="main-controls">
        <button id="start-btn" aria-label="Start or stop engine">Start Engine</button>
        <button id="pedal-btn" class="pedal" aria-label="Gas pedal - hold to accelerate">üöÄ GAS PEDAL</button>
      </div>

      <!-- Recording and Share Controls -->
      <div class="action-bar">
        <button id="record-btn" class="action-btn record-btn" aria-label="Record engine audio" title="Record engine audio">‚è∫ Record</button>
        <button id="share-btn" class="action-btn share-btn" aria-label="Share current engine settings" title="Share settings via URL">üîó Share</button>
      </div>

      <!-- Speed and Gear Display -->
      <div class="speed-gear-row">
        <div class="speed-display-box">
          <div class="display-value"><span id="speed-value">0</span></div>
          <div class="display-label">km/h</div>
        </div>
        <div class="gear-display-box">
          <div class="display-value" id="gear-value">N</div>
          <div class="display-label">GEAR</div>
        </div>
      </div>

      <!-- Gear Shift Buttons -->
      <div class="gear-buttons">
        <button class="gear-btn" data-gear="0" title="Neutral (N)">N</button>
        <button class="gear-btn active" data-gear="1" title="1st Gear (1)">1</button>
        <button class="gear-btn" data-gear="2" title="2nd Gear (2)">2</button>
        <button class="gear-btn" data-gear="3" title="3rd Gear (3)">3</button>
        <button class="gear-btn" data-gear="4" title="4th Gear (4)">4</button>
        <button class="gear-btn" data-gear="5" title="5th Gear (5)">5</button>
        <button class="gear-btn" data-gear="6" title="6th Gear (6)">6</button>
      </div>

      <!-- Performance Metrics -->
      <div class="performance-metrics">
        <div class="metric">
          <div class="metric-label">0-100 km/h</div>
          <div class="metric-value" id="accel-time">--</div>
        </div>
        <div class="metric">
          <div class="metric-label">Top Speed</div>
          <div class="metric-value" id="top-speed">0 km/h</div>
        </div>
      </div>

      <!-- Throttle and Load Bars -->
      <div class="bars-container">
        <div class="bar-group">
          <div class="label">Throttle</div>
          <div class="throttle-bar" role="meter" aria-label="Throttle level" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            <div class="throttle-fill" id="throttle-fill"></div>
          </div>
        </div>
        <div class="bar-group">
          <div class="label">Load</div>
          <div class="load-bar" role="meter" aria-label="Load level" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            <div class="load-fill" id="load-fill"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="controls" role="region" aria-label="Engine controls">
      <p id="status" role="status" aria-live="polite">Ready</p>

      <div class="settings" role="region" aria-label="Engine parameters">
        <div class="control-group">
          <label for="engine-preset">Preset:</label>
          <select id="engine-preset" aria-label="Engine preset selection">
            <option value="custom">Custom</option>
            <option value="na">NA (Naturally Aspirated)</option>
            <option value="turbo">Turbo-like</option>
            <option value="vtec">VTEC (High-cam Crossover)</option>
            <option value="fa24">FA24 (Boxer Rumble)</option>
            <option value="v8">V8 (American Muscle)</option>
            <option value="rotary">Rotary (Wankel)</option>
          </select>
        </div>

        <div class="control-group">
          <label for="ncyl">Cylinders:</label>
          <input type="number" id="ncyl" value="4" min="1" max="12" aria-label="Number of cylinders">
        </div>

        <div class="control-group">
          <label for="idle-rpm">Idle RPM:</label>
          <input type="number" id="idle-rpm" value="900" min="500" max="2000" aria-label="Idle RPM value">
        </div>

        <div class="control-group">
          <label for="redline-rpm">Redline RPM:</label>
          <input type="number" id="redline-rpm" value="7000" min="3000" max="12000" aria-label="Redline RPM value">
        </div>

        <div class="control-group">
          <label for="inertia">Inertia (0-1):</label>
          <input type="range" id="inertia" min="0.8" max="0.99" step="0.01" value="0.95" aria-label="Engine inertia">
        </div>

        <div class="control-group">
          <label for="noise-gain">Noise:</label>
          <input type="range" id="noise-gain" min="0" max="1" step="0.01" value="0.2" aria-label="Noise level">
        </div>

        <div class="control-group">
          <label for="gear">Gear:</label>
          <select id="gear" aria-label="Gear selection">
            <option value="0">Neutral</option>
            <option value="1" selected>1st</option>
            <option value="2">2nd</option>
            <option value="3">3rd</option>
            <option value="4">4th</option>
            <option value="5">5th</option>
            <option value="6">6th</option>
          </select>
        </div>

        <div class="control-group">
          <label for="load">Road Load (0-1):</label>
          <input type="range" id="load" min="0" max="1" step="0.01" value="0.0" aria-label="Road load or incline">
        </div>

        <div class="control-group">
          <label for="audio-perspective">Perspective:</label>
          <select id="audio-perspective" aria-label="Audio perspective selection">
            <option value="exterior">Exterior (Muffler)</option>
            <option value="interior">Interior (Cabin)</option>
            <option value="enginebay">Engine Bay</option>
          </select>
        </div>

        <div class="control-group">
          <label for="real-vehicle-mode">Real Vehicle Mode:</label>
          <input type="checkbox" id="real-vehicle-mode" aria-label="Enable real vehicle mode using GPS and accelerometer">
          <span id="sensor-status" class="sensor-status">Off</span>
        </div>

        <!-- Real Vehicle Mode Parameters (shown only when real vehicle mode is enabled) -->
        <div id="real-vehicle-params" style="display:none;">
          <div class="control-group">
            <label for="accel-threshold">Accel Threshold (m/s¬≤):</label>
            <input type="number" id="accel-threshold" value="0.5" min="0.0" max="3.0" step="0.1" aria-label="Acceleration threshold for throttle estimation">
          </div>
          <div class="control-group">
            <label for="accel-max">Max Accel (m/s¬≤):</label>
            <input type="number" id="accel-max" value="5.0" min="1.0" max="15.0" step="0.5" aria-label="Maximum acceleration mapped to full throttle">
          </div>
          <div class="control-group">
            <label for="cruise-throttle">Cruise Throttle (0-1):</label>
            <input type="number" id="cruise-throttle" value="0.15" min="0.0" max="0.5" step="0.01" aria-label="Throttle level when cruising at constant speed">
          </div>
        </div>

        <div class="control-group">
          <label for="compressor-enabled">Compressor:</label>
          <input type="checkbox" id="compressor-enabled" aria-label="Enable compressor effect">
          <input type="range" id="compressor-amount" min="0" max="1" step="0.01" value="0.5" aria-label="Compressor amount">
        </div>

        <div class="control-group">
          <label for="reverb-enabled">Reverb:</label>
          <input type="checkbox" id="reverb-enabled" aria-label="Enable reverb effect">
          <input type="range" id="reverb-amount" min="0" max="1" step="0.01" value="0.3" aria-label="Reverb amount">
        </div>
      </div>

      <div class="instructions">
        <p><strong>Controls:</strong></p>
        <ul>
          <li><strong>SPACE / ‚Üë / W</strong> - Accelerate</li>
          <li><strong>1-6</strong> - Shift gears</li>
          <li><strong>N</strong> - Neutral</li>
        </ul>
      </div>

      <!-- PWA Install Prompt -->
      <div id="install-bar" class="install-bar" style="display:none;">
        <span class="install-label">üì± Add to Home Screen for the best experience</span>
        <button id="install-btn" class="install-btn" aria-label="Install app to home screen">Install App</button>
        <button id="install-dismiss" class="install-dismiss" aria-label="Dismiss install prompt">‚úï</button>
      </div>
    </div>
  </div>
  <script src="app.js"></script>
</body>
</html>
